# Secret Detection Patterns for DeployGuard
# These patterns are used to identify potentially exposed secrets in code

patterns:
  # Cloud Provider Credentials
  - name: "AWS Access Key ID"
    pattern: "(A3T[A-Z0-9]|AKIA|AGPA|AIDA|AROA|AIPA|ANPA|ANVA|ASIA)[A-Z0-9]{16}"
    secret_type: "aws_access_key"
    severity: "critical"
    description: "AWS Access Key ID detected"
    remediation: "Remove hardcoded AWS credentials and use IAM roles or environment variables"

  - name: "AWS Secret Access Key"
    pattern: "(?i)aws(.{0,20})?['\"][0-9a-zA-Z/+]{40}['\"]"
    secret_type: "aws_secret_key"
    severity: "critical"
    description: "AWS Secret Access Key detected"
    remediation: "Remove hardcoded AWS credentials and use IAM roles or environment variables"

  # GitHub Tokens
  - name: "GitHub Personal Access Token"
    pattern: "ghp_[a-zA-Z0-9]{36}"
    secret_type: "github_token"
    severity: "critical"
    description: "GitHub Personal Access Token detected"
    remediation: "Revoke the token and use GitHub Secrets for sensitive data"

  - name: "GitHub OAuth Token"
    pattern: "gho_[a-zA-Z0-9]{36}"
    secret_type: "github_token"
    severity: "critical"
    description: "GitHub OAuth Token detected"
    remediation: "Revoke the token and use GitHub Secrets for sensitive data"

  - name: "GitHub App Token"
    pattern: "ghu_[a-zA-Z0-9]{36}"
    secret_type: "github_token"
    severity: "critical"
    description: "GitHub App Token detected"
    remediation: "Revoke the token and use GitHub Secrets for sensitive data"

  - name: "GitHub Refresh Token"
    pattern: "ghr_[a-zA-Z0-9]{36}"
    secret_type: "github_token"
    severity: "critical"
    description: "GitHub Refresh Token detected"
    remediation: "Revoke the token and use GitHub Secrets for sensitive data"

  # GitLab Tokens
  - name: "GitLab Personal Access Token"
    pattern: "glpat-[a-zA-Z0-9_-]{20}"
    secret_type: "gitlab_token"
    severity: "critical"
    description: "GitLab Personal Access Token detected"
    remediation: "Revoke the token and use GitLab CI/CD variables"

  # BitBucket
  - name: "BitBucket Access Token"
    pattern: "(?i)bitbucket(.{0,20})?['\"][a-zA-Z0-9]{32}['\"]"
    secret_type: "bitbucket_token"
    severity: "critical"
    description: "BitBucket Access Token detected"
    remediation: "Revoke the token and use repository variables"

  # Database Connection Strings
  - name: "MongoDB Connection String"
    pattern: "mongodb(\\+srv)?://[^\\s'\"]+"
    secret_type: "database_connection"
    severity: "high"
    description: "MongoDB connection string with credentials detected"
    remediation: "Use environment variables for database connection strings"

  - name: "PostgreSQL Connection String"
    pattern: "postgres(ql)?://[^\\s'\"]+"
    secret_type: "database_connection"
    severity: "high"
    description: "PostgreSQL connection string with credentials detected"
    remediation: "Use environment variables for database connection strings"

  - name: "MySQL Connection String"
    pattern: "mysql://[^\\s'\"]+"
    secret_type: "database_connection"
    severity: "high"
    description: "MySQL connection string with credentials detected"
    remediation: "Use environment variables for database connection strings"

  # Private Keys
  - name: "RSA Private Key"
    pattern: "-----BEGIN (RSA )?PRIVATE KEY-----"
    secret_type: "private_key"
    severity: "critical"
    description: "RSA private key detected"
    remediation: "Remove private keys from repository and use secure key management"

  - name: "EC Private Key"
    pattern: "-----BEGIN EC PRIVATE KEY-----"
    secret_type: "private_key"
    severity: "critical"
    description: "EC private key detected"
    remediation: "Remove private keys from repository and use secure key management"

  - name: "OpenSSH Private Key"
    pattern: "-----BEGIN OPENSSH PRIVATE KEY-----"
    secret_type: "ssh_key"
    severity: "critical"
    description: "OpenSSH private key detected"
    remediation: "Remove SSH keys from repository and use SSH agent or key management"

  - name: "DSA Private Key"
    pattern: "-----BEGIN DSA PRIVATE KEY-----"
    secret_type: "private_key"
    severity: "critical"
    description: "DSA private key detected"
    remediation: "Remove private keys from repository and use secure key management"

  - name: "PGP Private Key"
    pattern: "-----BEGIN PGP PRIVATE KEY BLOCK-----"
    secret_type: "private_key"
    severity: "critical"
    description: "PGP private key detected"
    remediation: "Remove PGP keys from repository and use secure key management"

  # API Keys and Tokens
  - name: "Generic API Key"
    pattern: "(?i)(api[_-]?key|apikey)\\s*[:=]\\s*['\"]([a-zA-Z0-9_\\-]{20,})['\"]"
    secret_type: "api_key"
    severity: "high"
    description: "Generic API key detected"
    remediation: "Use environment variables for API keys"

  - name: "JWT Token"
    pattern: "eyJ[a-zA-Z0-9_-]*\\.eyJ[a-zA-Z0-9_-]*\\.[a-zA-Z0-9_-]*"
    secret_type: "jwt_token"
    severity: "medium"
    description: "JWT token detected"
    remediation: "Ensure JWT tokens are not committed and use secure token storage"

  # Passwords - Multiple patterns for comprehensive coverage
  - name: "Generic Password (quoted)"
    pattern: "(?i)(password|passwd|pwd)\\s*[:=]\\s*['\"]([^'\"]{4,})['\"]"
    secret_type: "password"
    severity: "high"
    description: "Hardcoded password detected"
    remediation: "Remove hardcoded passwords and use environment variables"

  - name: "Password Variable (quoted)"
    pattern: "(?i)[A-Z_]*(PASSWORD|PASSWD|PASS|PWD)[A-Z_]*\\s*=\\s*['\"]([^'\"]{4,})['\"]"
    secret_type: "password"
    severity: "high"
    description: "Password assigned to variable with password-related name"
    remediation: "Remove hardcoded passwords and use environment variables"

  - name: "Password Variable (unquoted)"
    pattern: "(?i)[A-Z_]*(PASSWORD|PASSWD|PASS|PWD)[A-Z_]*\\s*=\\s*(?!\\$)[^\\s'\"\\n$]{6,}"
    secret_type: "password"
    severity: "high"
    description: "Unquoted password assigned to variable"
    remediation: "Remove hardcoded passwords and use environment variables"

  - name: "Database Password URL"
    pattern: "(?i)(mysql|postgres|postgresql|mongodb|redis|oracle)://[^:]+:([^@\\s]{4,})@"
    secret_type: "database_password"
    severity: "critical"
    description: "Database connection string with embedded password"
    remediation: "Use environment variables for database credentials"

  # OAuth Secrets
  - name: "OAuth Client Secret"
    pattern: "(?i)(client[_-]?secret|oauth[_-]?secret)\\s*[:=]\\s*['\"]([a-zA-Z0-9_\\-]{20,})['\"]"
    secret_type: "oauth_secret"
    severity: "critical"
    description: "OAuth client secret detected"
    remediation: "Use environment variables for OAuth credentials"

  # Encryption Keys
  - name: "Encryption Key"
    pattern: "(?i)(encryption[_-]?key|secret[_-]?key)\\s*[:=]\\s*['\"]([a-zA-Z0-9+/=]{32,})['\"]"
    secret_type: "encryption_key"
    severity: "critical"
    description: "Encryption key detected"
    remediation: "Use secure key management service (KMS, Vault, etc.)"

  # Certificates
  - name: "Certificate"
    pattern: "-----BEGIN CERTIFICATE-----"
    secret_type: "certificate"
    severity: "medium"
    description: "Certificate detected"
    remediation: "Certificates should not be committed to public repositories"

  # =============================================================================
  # HARDCODED CONFIGURATION VALUES
  # These detect any hardcoded values that should be environment variables
  # =============================================================================

  # Hostnames and IPs
  - name: "Hardcoded Hostname"
    pattern: "(?i)(HOST|HOSTNAME|DB_HOST|DATABASE_HOST|REDIS_HOST|MYSQL_HOST|POSTGRES_HOST|SERVER_HOST|API_HOST)\\s*[=:]\\s*['\"]([^'\"\\s]+)['\"]"
    secret_type: "hostname"
    severity: "medium"
    description: "Hardcoded hostname detected"
    remediation: "Use environment variable for hostname configuration"

  - name: "Hardcoded IP Address"
    pattern: "(?i)(HOST|IP|IP_ADDRESS|SERVER_IP)\\s*[=:]\\s*['\"]?(\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})['\"]?"
    secret_type: "ip_address"
    severity: "medium"
    description: "Hardcoded IP address detected"
    remediation: "Use environment variable for IP address configuration"

  # Usernames
  - name: "Hardcoded Username"
    pattern: "(?i)(USER|USERNAME|DB_USER|DATABASE_USER|MYSQL_USER|POSTGRES_USER|ADMIN_USER|API_USER)\\s*[=:]\\s*['\"]([^'\"\\s]{2,})['\"]"
    secret_type: "username"
    severity: "medium"
    description: "Hardcoded username detected"
    remediation: "Use environment variable for username configuration"

  - name: "Hardcoded Username (unquoted)"
    pattern: "(?i)(DB_USER|DATABASE_USER|MYSQL_USER|POSTGRES_USER)\\s*=\\s*(?!\\$)([a-zA-Z][a-zA-Z0-9_]{2,})"
    secret_type: "username"
    severity: "medium"
    description: "Hardcoded username detected"
    remediation: "Use environment variable for username configuration"

  # Ports
  - name: "Hardcoded Port"
    pattern: "(?i)(PORT|DB_PORT|DATABASE_PORT|API_PORT|SERVER_PORT|REDIS_PORT)\\s*[=:]\\s*['\"]?(\\d{2,5})['\"]?"
    secret_type: "port"
    severity: "low"
    description: "Hardcoded port number detected"
    remediation: "Consider using environment variable for port configuration"

  # Database Names
  - name: "Hardcoded Database Name"
    pattern: "(?i)(DB_NAME|DATABASE_NAME|DATABASE|MYSQL_DATABASE|POSTGRES_DB|MONGODB_DATABASE)\\s*[=:]\\s*['\"]([^'\"\\s]+)['\"]"
    secret_type: "database_name"
    severity: "medium"
    description: "Hardcoded database name detected"
    remediation: "Use environment variable for database name configuration"

  # URLs and Endpoints
  - name: "Hardcoded API URL"
    pattern: "(?i)(API_URL|BASE_URL|BACKEND_URL|SERVICE_URL|ENDPOINT|API_ENDPOINT)\\s*[=:]\\s*['\"]([^'\"\\s]+)['\"]"
    secret_type: "url"
    severity: "medium"
    description: "Hardcoded API URL detected"
    remediation: "Use environment variable for URL configuration"

  - name: "Hardcoded URL with credentials"
    pattern: "(?i)(https?|ftp)://[^:]+:[^@]+@[^\\s'\"]+"
    secret_type: "url"
    severity: "high"
    description: "URL with embedded credentials detected"
    remediation: "Remove credentials from URL and use environment variables"

  # Secret/API Keys (generic)
  - name: "Hardcoded Secret Key"
    pattern: "(?i)(SECRET_KEY|APP_SECRET|APPLICATION_SECRET|SIGNING_KEY)\\s*[=:]\\s*['\"]([^'\"]{8,})['\"]"
    secret_type: "secret_key"
    severity: "critical"
    description: "Hardcoded secret key detected"
    remediation: "Use environment variable for secret key"

  - name: "Hardcoded API Key Variable"
    pattern: "(?i)([A-Z_]*(API_KEY|APIKEY)[A-Z_]*)\\s*[=:]\\s*['\"]([^'\"]{8,})['\"]"
    secret_type: "api_key"
    severity: "high"
    description: "Hardcoded API key detected"
    remediation: "Use environment variable for API key"

  # Auth Tokens
  - name: "Hardcoded Auth Token"
    pattern: "(?i)(AUTH_TOKEN|ACCESS_TOKEN|BEARER_TOKEN|TOKEN)\\s*[=:]\\s*['\"]([a-zA-Z0-9_\\-\\.]{20,})['\"]"
    secret_type: "auth_token"
    severity: "high"
    description: "Hardcoded authentication token detected"
    remediation: "Use environment variable for authentication tokens"

  - name: "Bearer Token in Header"
    pattern: "(?i)Authorization['\"]?\\s*[=:]\\s*['\"]?Bearer\\s+([a-zA-Z0-9_\\-\\.]+)"
    secret_type: "bearer_token"
    severity: "high"
    description: "Bearer token in authorization header detected"
    remediation: "Use environment variable for bearer tokens"

  # Redis
  - name: "Hardcoded Redis URL"
    pattern: "(?i)redis://[^\\s'\"]+"
    secret_type: "url"
    severity: "high"
    description: "Redis connection URL detected"
    remediation: "Use environment variable for Redis connection"

  # Generic Environment Variables Pattern
  - name: "Environment Variable Assignment"
    pattern: "(?i)export\\s+([A-Z][A-Z0-9_]*)\\s*=\\s*['\"]([^'\"]+)['\"]"
    secret_type: "hardcoded_value"
    severity: "medium"
    description: "Hardcoded value in export statement"
    remediation: "Move sensitive values to secure environment configuration"

# File patterns to always scan
file_patterns:
  include:
    - "**/*.py"
    - "**/*.js"
    - "**/*.ts"
    - "**/*.jsx"
    - "**/*.tsx"
    - "**/*.java"
    - "**/*.go"
    - "**/*.rs"
    - "**/*.rb"
    - "**/*.php"
    - "**/*.cs"
    - "**/*.sh"
    - "**/*.bash"
    - "**/*.zsh"
    - "**/*.yaml"
    - "**/*.yml"
    - "**/*.json"
    - "**/*.xml"
    - "**/*.properties"
    - "**/*.env"
    - "**/*.config"
    - "**/*.ini"
    - "**/*.toml"

  exclude:
    - "**/node_modules/**"
    - "**/vendor/**"
    - "**/dist/**"
    - "**/build/**"
    - "**/.git/**"
    - "**/*.min.js"
    - "**/*.min.css"
    - "**/package-lock.json"
    - "**/yarn.lock"
    - "**/poetry.lock"
    - "**/*.pyc"
    - "**/__pycache__/**"

# Entropy detection settings
entropy:
  enabled: true
  min_entropy: 4.5
  min_length: 20
  exclude_patterns:
    - "^[0-9]+$"  # Pure numbers
    - "^[a-f0-9]{32,}$"  # Likely hashes
